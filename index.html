<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High-Speed IPTV Stream</title>
    <script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }
        #player {
            width: 100%;
            height: 100%;
            max-width: 1000px;
            aspect-ratio: 16 / 9;
        }
        .info-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #00ff00;
            font-family: 'Courier New', Courier, monospace;
            font-size: 12px;
            background: rgba(0,0,0,0.5);
            padding: 5px 10px;
            border-radius: 4px;
            pointer-events: none;
        }
    </style>
</head>
<body>

<div class="info-overlay">‚óè LIVE PROXY ACTIVE | 1Gbps PORT</div>
<div id="player"></div>

<script>
    // Replace this with your Server Proxy URL
    var streamURL = 'https://xtv.ooo/0067804946/4761032132/167574';

    var player = new Clappr.Player({
        source: streamURL,
        parentId: "#player",
        autoPlay: true,
        width: '100%',
        height: '100%',
        mediacontrol: {seekbar: "#00ff00", buttons: "#00ff00"},
        playback: {
            hlsjsConfig: {
                enableWorker: true
            }
        },
        // Error handling for auto-reconnect
        events: {
            onError: function(e) {
                console.log("Stream Error. Retrying...");
                setTimeout(function() {
                    player.load(streamURL);
                    player.play();
                }, 3000);
            }
        }
    });
</script>

</body>
</html>
        .controls-bar { position: sticky; top: 0; background: var(--bg); z-index: 900; padding: 10px 0; margin-bottom: 20px; border-bottom: 1px solid #222; }
        .search-input { background: #1a1a1a !important; border: 1px solid #333 !important; color: white !important; border-radius: 20px !important; }

        /* Player Overlay */
        #player-overlay { display: none; position: fixed; inset: 0; background: #000; z-index: 9999; flex-direction: column; }
        .p-top { padding: 15px 25px; background: #0a0a0a; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; }
        #dplayer { flex: 1; width: 100%; }
        
        /* Login Form */
        #login-scr { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; align-items: center; justify-content: center; background-image: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://assets.nflxext.com/ffe/siteui/vlv3/f841d4c7-10e1-40af-bca1-07e3f8eb14af/8a304529-11fa-4579-976a-392269aa5f1c/IN-en-20220502-popsignuptwoweeks-perspective_alpha_website_medium.jpg'); background-size: cover; }
        .login-box { background: rgba(0, 0, 0, 0.85); padding: 50px; border-radius: 8px; width: 100%; max-width: 400px; }
        
        @media (max-width: 768px) {
            .sidebar { width: 100%; height: auto; max-height: 200px; position: relative; }
            .main-content { margin-left: 0; }
            .m-card img { height: 200px; }
        }
    </style>
</head>
<body>

<div id="login-scr">
    <div class="login-box">
        <h1 class="text-danger fw-bold text-center mb-4">4KSJ CINEMA</h1>
        <div class="mb-3">
            <input type="text" id="user" class="form-control form-control-lg search-input" placeholder="Username">
        </div>
        <div class="mb-4">
            <input type="password" id="pass" class="form-control form-control-lg search-input" placeholder="Password">
        </div>
        <button onclick="doLogin()" id="loginBtn" class="btn btn-danger w-100 fw-bold py-3">SIGN IN</button>
        <p class="text-muted mt-3 text-center small">Enter your credentials to access the 4K stream server.</p>
    </div>
</div>

<div id="dashboard" style="display:none;">
    <aside class="sidebar" id="categories"></aside>
    
    <main class="main-content">
        <div class="controls-bar d-flex flex-wrap gap-3 align-items-center justify-content-between">
            <div class="d-flex gap-2">
                <button id="btn-live" class="btn btn-danger px-4" onclick="fetchCats('get_live_categories')">LIVE TV</button>
                <button id="btn-vod" class="btn btn-outline-light px-4" onclick="fetchCats('get_vod_categories')">MOVIES</button>
            </div>
            <div class="flex-grow-1 mx-md-4">
                <input type="text" id="searchBar" class="form-control search-input" placeholder="Search for channels or movies..." onkeyup="filterItems()">
            </div>
        </div>
        
        <div id="itemGrid" class="row row-cols-2 row-cols-md-3 row-cols-lg-5 g-4">
            </div>
    </main>
</div>

<div id="player-overlay">
    <div class="p-top">
        <h5 id="vTitle" class="m-0 text-truncate">Stream Player</h5>
        <button onclick="closePlayer()" class="btn btn-outline-light btn-sm rounded-circle"><i class="fas fa-times"></i></button>
    </div>
    <div id="dplayer"></div>
    <div class="p-3 text-center bg-dark">
        <div class="btn-group">
            <a id="vlcBtn" class="btn btn-warning btn-sm fw-bold mx-1 rounded">VLC PLAYER</a>
            <a id="mxBtn" class="btn btn-primary btn-sm fw-bold mx-1 rounded">MX PLAYER</a>
        </div>
    </div>
</div>

<script>
    // Configuration - GitHub par host karte waqt isse badal sakte hain
    const CONFIG = {
        SERVER: "https://sjstorestar4k.store",
        PROXY: "https://api.allorigins.win/get?url=",
        DEFAULT_POSTER: "https://via.placeholder.com/300x450?text=No+Poster"
    };

    let U, P, dpInstance, currentItems = [];

    async function callApi(url) {
        try {
            const response = await fetch(CONFIG.PROXY + encodeURIComponent(url));
            const data = await response.json();
            return JSON.parse(data.contents);
        } catch (err) {
            console.error("API Error:", err);
            return null;
        }
    }

    async function doLogin() {
        const btn = document.getElementById('loginBtn');
        U = document.getElementById('user').value;
        P = document.getElementById('pass').value;

        if(!U || !P) return alert("Please fill all fields");
        
        btn.innerText = "CONNECTING...";
        const res = await callApi(`${CONFIG.SERVER}/player_api.php?username=${U}&password=${P}`);
        
        if(res && res.user_info && res.user_info.auth === 1) {
            document.getElementById('login-scr').style.fadeOut = 300;
            setTimeout(() => {
                document.getElementById('login-scr').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                fetchCats('get_live_categories');
            }, 300);
        } else {
            alert("Login Failed! Check credentials.");
            btn.innerText = "ACCESS SERVER";
        }
    }

    async function fetchCats(action) {
        // Toggle Active Button UI
        if(action.includes('live')) {
            document.getElementById('btn-live').className = 'btn btn-danger px-4';
            document.getElementById('btn-vod').className = 'btn btn-outline-light px-4';
        } else {
            document.getElementById('btn-live').className = 'btn btn-outline-light px-4';
            document.getElementById('btn-vod').className = 'btn btn-danger px-4';
        }

        const data = await callApi(`${CONFIG.SERVER}/player_api.php?username=${U}&password=${P}&action=${action}`);
        const container = document.getElementById('categories');
        container.innerHTML = '<div class="p-4 fw-bold text-white-50 small uppercase">MENU NAVIGATION</div>';
        
        if(!data) return;

        data.forEach(item => {
            const div = document.createElement('div');
            div.className = 'cat-item';
            div.innerHTML = `<i class="fas fa-folder me-2 shadow-sm"></i> ${item.category_name}`;
            div.onclick = () => {
                document.querySelectorAll('.cat-item').forEach(el => el.classList.remove('active'));
                div.classList.add('active');
                fetchItems(action.replace('categories', 'streams'), item.category_id);
            };
            container.appendChild(div);
        });
    }

    async function fetchItems(action, catId) {
        const grid = document.getElementById('itemGrid');
        grid.innerHTML = '<div class="text-center w-100 p-5"><div class="spinner-border text-danger"></div></div>';
        
        const data = await callApi(`${CONFIG.SERVER}/player_api.php?username=${U}&password=${P}&action=${action}&category_id=${catId}`);
        currentItems = data || [];
        renderGrid(currentItems, action);
    }

    function renderGrid(items, action) {
        const grid = document.getElementById('itemGrid');
        grid.innerHTML = '';
        
        items.forEach(item => {
            const isLive = action.includes('live');
            const streamUrl = isLive 
                ? `${CONFIG.SERVER}/live/${U}/${P}/${item.stream_id}.ts` 
                : `${CONFIG.SERVER}/movie/${U}/${P}/${item.stream_id}.mp4`;
            
            const poster = item.stream_icon || item.cover || CONFIG.DEFAULT_POSTER;
            const cleanTitle = item.name.replace(/'/g, "");

            const card = document.createElement('div');
            card.className = 'col';
            card.innerHTML = `
                <div class="m-card" onclick="initPlayer('${streamUrl}', '${cleanTitle}', ${isLive})">
                    <img src="${poster}" onerror="this.src='${CONFIG.DEFAULT_POSTER}'" loading="lazy">
                    <div class="m-info">${item.name}</div>
                </div>`;
            grid.appendChild(card);
        });
    }

    function filterItems() {
        const query = document.getElementById('searchBar').value.toLowerCase();
        const cards = document.querySelectorAll('.col');
        cards.forEach(card => {
            const title = card.querySelector('.m-info').innerText.toLowerCase();
            card.style.display = title.includes(query) ? 'block' : 'none';
        });
    }

    function initPlayer(url, title, isLive) {
        document.getElementById('player-overlay').style.display = 'flex';
        document.getElementById('vTitle').innerText = title;
        
        // External Intents
        document.getElementById('vlcBtn').href = `vlc://${url}`;
        document.getElementById('mxBtn').href = `intent://${url.replace(/^https?:\/\//, "")}#Intent;scheme=https;package=com.mxtech.videoplayer.ad;S.title=${title};end`;

        if (dpInstance) dpInstance.destroy();
        
        dpInstance = new DPlayer({
            container: document.getElementById('dplayer'),
            live: isLive,
            autoplay: true,
            theme: '#e50914',
            video: {
                url: url,
                type: isLive ? 'hls' : 'auto',
                customType: {
                    hls: function(video) {
                        if (Hls.isSupported()) {
                            const hls = new Hls();
                            hls.loadSource(video.src);
                            hls.attachTo(video);
                        }
                    }
                }
            }
        });
    }

    function closePlayer() {
        if (dpInstance) dpInstance.pause();
        document.getElementById('player-overlay').style.display = 'none';
    }
</script>

</body>
</html>
