<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4KSJ IPTV Player</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f0f0f; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .login-box { background: #1e1e1e; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); width: 320px; text-align: center; border: 1px solid #333; }
        h2 { color: #e50914; margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 5px; border: 1px solid #444; background: #2b2b2b; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #e50914; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 10px; }
        button:hover { background: #b20710; }
        #status { margin-top: 15px; font-size: 14px; color: #ffcc00; min-height: 20px; }
    </style>
</head>
<body>

    <div class="login-box">
        <h2>4KSJ PLAYER</h2>
        <p style="font-size: 12px; color: #888;">Enter your credentials to login</p>
        <input type="text" id="user" placeholder="Username">
        <input type="password" id="pass" placeholder="Password">
        <button id="loginBtn" onclick="login()">Login</button>
        <div id="status"></div>
    </div>

    <script>
        async function login() {
            const user = document.getElementById('user').value;
            const pass = document.getElementById('pass').value;
            const status = document.getElementById('status');
            const btn = document.getElementById('loginBtn');

            if(!user || !pass) {
                status.innerText = "Username aur Password zaruri hai!";
                return;
            }

            status.style.color = "#ffcc00";
            status.innerText = "Connecting to 4KSJ Server...";
            btn.disabled = true;

            // Aapka Server URL
            const serverUrl = "http://4ksj.store:8080";
            
            // CORS Proxy (GitHub se HTTP server connect karne ke liye)
            const proxy = "https://corsproxy.io/?";
            
            const finalUrl = `${proxy}${encodeURIComponent(serverUrl + '/player_api.php?username=' + user + '&password=' + pass)}`;

            try {
                const response = await fetch(finalUrl);
                const data = await response.json();

                if (data.user_info && data.user_info.auth === 1) {
                    status.style.color = "#00ff00";
                    status.innerText = "Login Success! Welcome " + user;
                    // Login ke baad kahan jana hai, wo link yahan dalen:
                    // window.location.href = "dashboard.html"; 
                } else {
                    status.style.color = "#ff4444";
                    status.innerText = "Wrong Username or Password!";
                    btn.disabled = false;
                }
            } catch (error) {
                status.style.color = "#ff4444";
                status.innerText = "Server Error! Please try again later.";
                console.error("Error:", error);
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
        #player-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.98); display: none; align-items: center; justify-content: center; z-index: 9999; }
        .player-container { width: 90%; max-width: 1000px; position: relative; }
        .close-p { position: absolute; top: -50px; right: 0; font-size: 40px; color: white; cursor: pointer; }
    </style>
</head>
<body>

    <div id="login-box">
        <div class="glass-card">
            <h1>4KSJ PREMIUM</h1>
            <input type="text" id="usr" placeholder="Username">
            <input type="password" id="pwd" placeholder="Password">
            <button class="login-btn" onclick="ott.init()">SIGN IN</button>
            <p id="msg" style="color: #888; font-size: 12px; margin-top: 15px;">Secure Xtream Codes Access</p>
        </div>
    </div>

    <div id="dashboard">
        <div class="top-nav">
            <h2>OTT PRO</h2>
            <div class="nav-link active" onclick="ott.load('get_live_streams')">LIVE TV</div>
            <div class="nav-link" onclick="ott.load('get_vod_streams')">MOVIES</div>
            <div class="nav-link" onclick="ott.load('get_series')">SERIES</div>
        </div>
        <div class="content-area">
            <div id="grid" class="movie-grid"></div>
        </div>
    </div>

    <div id="player-modal">
        <div class="player-container">
            <span class="close-p" onclick="ott.stop()">&times;</span>
            <video id="p" class="video-js vjs-16-9 vjs-big-play-centered" controls></video>
        </div>
    </div>

    <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
    <script>
        const ott = {
            h: "http://4ksj.store:8080",
            pr: "https://api.allorigins.win/get?url=",
            u: "", p: "", v: null,

            init: function() {
                this.u = document.getElementById('usr').value;
                this.p = document.getElementById('pwd').value;
                if(!this.u || !this.p) return alert("Details Enter Karein!");
                document.getElementById('msg').innerText = "Loading Next Level UI...";
                this.load('get_live_streams');
                this.v = videojs('p');
            },

            async load(act) {
                const url = `${this.h}/player_api.php?username=${this.u}&password=${this.p}&action=${act}`;
                try {
                    const res = await fetch(this.pr + encodeURIComponent(url));
                    const d = await res.json();
                    const list = JSON.parse(d.contents);
                    
                    document.getElementById('login-box').style.display = 'none';
                    document.getElementById('dashboard').style.display = 'block';
                    const g = document.getElementById('grid');
                    g.innerHTML = "";

                    (Array.isArray(list) ? list : []).slice(0, 80).forEach(i => {
                        const div = document.createElement('div');
                        div.className = 'movie-card';
                        const img = i.stream_icon || i.series_cover || 'https://via.placeholder.com/200x300?text=No+Poster';
                        div.innerHTML = `<img src="${img}"><div class="info">${i.name}</div>`;
                        div.onclick = () => this.play(i, act);
                        g.appendChild(div);
                    });
                } catch(e) { alert("Server Error ya Wrong Login!"); }
            },

            play(i, act) {
                let s = "";
                if(act === 'get_live_streams') s = `${this.h}/live/${this.u}/${this.p}/${i.stream_id}.m3u8`;
                else s = `${this.h}/movie/${this.u}/${this.p}/${i.stream_id}.${i.container_extension || 'mp4'}`;
                
                document.getElementById('player-modal').style.display = 'flex';
                this.v.src({src: s, type: act==='get_live_streams'?'application/x-mpegURL':'video/mp4'});
                this.v.play();
            },

            stop() { this.v.pause(); document.getElementById('player-modal').style.display = 'none'; }
        };
    </script>
</body>
</html>
